https://bugs.webkit.org/show_bug.cgi?id=15569
https://bugs.webkit.org/show_bug.cgi?id=16227

--- origsrc/webkit-1.1.3/GNUmakefile.am	2009-03-29 14:37:05.562500000 -0500
+++ src/webkit-1.1.3/GNUmakefile.am	2009-03-29 15:15:23.437500000 -0500
@@ -99,6 +99,7 @@ javascriptcore_built_nosources :=
 javascriptcore_dist :=
 
 javascriptcore_cppflags += \
+	-DBUILDING_JSCORE \
 	-I$(srcdir)/JavaScriptCore \
 	-I$(srcdir)/JavaScriptCore/ForwardingHeaders \
 	-I$(srcdir)/JavaScriptCore/parser \
--- origsrc/webkit-1.1.3/JavaScriptCore/API/JSBase.h	2008-11-01 14:11:22.000000000 -0500
+++ src/webkit-1.1.3/JavaScriptCore/API/JSBase.h	2009-03-29 15:20:02.703125000 -0500
@@ -65,14 +65,14 @@ typedef struct OpaqueJSValue* JSObjectRe
 /* JavaScript symbol exports */
 
 #undef JS_EXPORT
-#if defined(__GNUC__)
+#if defined(WIN32) || defined(_WIN32) || defined(__CYGWIN__)
+    #ifdef BUILDING_JSCORE
+        #define JS_EXPORT __declspec(dllexport)
+    #else
+        #define JS_EXPORT __declspec(dllimport)
+    #endif
+#elif defined(__GNUC__)
     #define JS_EXPORT __attribute__((visibility("default")))
-#elif defined(WIN32) || defined(_WIN32)
-    /*
-     * TODO: Export symbols with JS_EXPORT when using MSVC.
-     * See http://bugs.webkit.org/show_bug.cgi?id=16227
-     */
-    #define JS_EXPORT
 #else
     #define JS_EXPORT
 #endif
--- origsrc/webkit-1.1.3/WebKit/gtk/webkit/webkitdefines.h	2009-03-03 14:20:45.000000000 -0600
+++ src/webkit-1.1.3/WebKit/gtk/webkit/webkitdefines.h	2009-03-29 01:54:12.468750000 -0500
@@ -23,7 +23,7 @@
 
 #include <glib.h>
 
-#ifdef G_OS_WIN32
+#ifdef G_PLATFORM_WIN32
     #ifdef BUILDING_WEBKIT
         #define WEBKIT_API __declspec(dllexport)
     #else
--- origsrc/webkit-1.1.3/autotools/webkit.m4	2009-01-31 09:10:45.000000000 -0600
+++ src/webkit-1.1.3/autotools/webkit.m4	2009-03-29 02:09:20.984375000 -0500
@@ -13,7 +13,7 @@ dnl check if we have the required packag
 dnl
 # check for -fvisibility=hidden compiler support (GCC >= 4)
 saved_CFLAGS="$CFLAGS"
-CFLAGS="$CFLAGS -fvisibility=hidden -fvisibility-inlines-hidden"
+CFLAGS="$CFLAGS -Werror -fvisibility=hidden -fvisibility-inlines-hidden"
 AC_MSG_CHECKING([if ${CXX} supports -fvisibility=hidden -fvisibility-inlines-hidden])
 AC_COMPILE_IFELSE([char foo;],
       [ AC_MSG_RESULT([yes])
